- name: macOS - Enable FileVault
  query: SELECT 1 FROM filevault_status WHERE status = 'FileVault is On.';
  critical: false
  description: This policy checks if FileVault (disk encryption) is enabled.
  resolution: As an IT admin, turn on disk encryption in Fleet.
  platform: darwin
- name: macOS - Enable Firewall
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.security.firewall' AND username = '' AND name='EnableFirewall' AND CAST(value AS INT) = 1;
  critical: false
  description: This policy checks if Firewall is enabled.
  resolution: An an IT admin, deploy a macOS, Firewall profile with the EnableFirewall option set to true.
  platform: darwin
- name: macOS - Disable guest account
  query: SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND username = '' AND name='DisableGuestAccount' AND CAST(value AS INT) = 1;
  critical: false
  description: This policy checks if the guest account is disabled.
  resolution: An an IT admin, deploy a macOS, login window profile with the DisableGuestAccount option set to true.
  platform: darwin
- name: macOS - Require 10 character password
  query: SELECT 1 WHERE 
    EXISTS (
      SELECT 1 FROM managed_policies WHERE 
        domain='com.apple.screensaver' AND 
        name='askForPassword' AND 
        CAST(value AS INT)
    ) 
    AND EXISTS (
      SELECT 1 FROM managed_policies WHERE 
        domain='com.apple.screensaver' AND 
        name='minLength' AND 
        CAST(value AS INT) <= 10
    );
  critical: false
  description: This policy checks if the end user is required to enter a password, with at least 10 characters, to unlock the host.
  resolution: An an IT admin, deploy a macOS, screensaver profile with the askForPassword option set to true and minLength option set to 10.
  platform: darwin
- name: macOS - Enable screen saver after 20 minutes
  query: SELECT 1 WHERE 
    EXISTS (
      SELECT 1 FROM managed_policies WHERE 
        domain='com.apple.screensaver' AND 
        name='idleTime' AND 
        CAST(value AS INT) <= 1200 AND 
        username = ''
    ) 
    AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
        domain='com.apple.screensaver' AND 
        name='idleTime' AND 
        CAST(value AS INT) > 1200
    );
  critical: false
  description: This policy checks if maximum amount of time (in minutes) the device is allowed to sit idle before the screen is locked. End users can select any value less than the specified maximum.
  resolution: An an IT admin, deploy a macOS, screen saver profile with the maxInactivity option set to 20 minutes.
  platform: darwin
- name: Windows - Enable screen saver after 20 minutes
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/DeviceLock/MaxInactivityTimeDeviceLock</LocURI></Target></Item></Get></SyncBody>" and CAST(mdm_command_output AS INT) <= 20;
  critical: false
  description: This policy checks if maximum amount of time (in minutes) the device is allowed to sit idle before the screen is locked. End users can select any value less than the specified maximum.
  resolution: "As an IT admin, to deploy a Windows profile with the MaxInactivityTimeDeviceLock option documented here: https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-devicelock#maxinactivitytimedevicelock"
  platform: windows
- name: Windows - Enable BitLocker
  query: SELECT * FROM bitlocker_info WHERE drive_letter='C:' AND protection_status = 1;
  critical: false
  description: As an IT admin, turn on disk encryption in Fleet.
  resolution: Ask your system administrator to turn on disk encryption in Fleet
  platform: windows
- name: Windows - Disable guest account
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/LocalPoliciesSecurityOptions/Accounts_EnableGuestAccountStatus</LocURI></Target></Item></Get></SyncBody>" and CAST(mdm_command_output AS INT) = 0;
  critical: false
  description: This policy checks if the guest account is disabled. The Guest account allows unauthenticated network users to gain access to the system.
  resolution: "As an IT admin, deploy a Windows profile with the Accounts_EnableGuestAccountStatus option documented here: https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-localpoliciessecurityoptions#accounts_enableguestaccountstatus"
  platform: windows
- name: Windows - Require 10 character password
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/DeviceLock/DevicePasswordEnabled</LocURI></Target></Item></Get></SyncBody>" and CAST(mdm_command_output AS INT) = 0;
  critical: false
  description: This policy checks if the end user is required to enter a password, with at least 10 characters, to unlock the host.
  resolution: "As an IT admin, deploy a Windows profile with the DevicePasswordEnabled and MinDevicePasswordLength option documented here: https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-devicelock"
  platform: windows
- name: Linux - Enable disk encryption
  query: SELECT 1 FROM disk_encryption WHERE encrypted=1 AND name LIKE '/dev/dm-1';
  critical: false
  description: This policy checks if disk encryption is enabled.
  resolution: As an IT admin, deploy an image that includes disk encryption.
  platform: linux
